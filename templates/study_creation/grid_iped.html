{% extends "base.html" %}

{% block title %}Grid Study IPED Parameters - Study Creation{% endblock %}

{% block content %}
<div class="study-creation-container">
    <div class="study-creation-header">
        <h1>Grid Study IPED Parameters</h1>
        <p>Configure IPED parameters for your grid study</p>
    </div>

            {{ study_progress_bar('grid_iped', 'grid', draft) }}

    <div class="form-container">
        <form method="POST" class="study-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            {% if calculated_values %}
                <input type="hidden" name="calculated_tasks_per_consumer" value="{{ calculated_values.tasks_per_consumer }}">
                <input type="hidden" name="calculated_total_elements" value="{{ calculated_values.total_elements }}">
                <input type="hidden" name="calculated_total_categories" value="{{ calculated_values.total_categories }}">
            {% endif %}
            
            <div class="form-section">
                <h3>IPED Parameters</h3>
                <p>Configure the parameters for your grid study's IPED (Image Preference Experimental Design).</p>
                
                <div class="form-group">
                    <label class="form-label">Number of Respondents</label>
                    {{ form.number_of_respondents(class="form-input", min="1", max="10000") }}
                    <small class="form-help">How many people will participate in your study? (1-10,000)</small>
                    {% if form.number_of_respondents.errors %}
                        <div class="form-error">
                            {% for error in form.number_of_respondents.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="info-box">
                    <h4>Auto-calculated Parameters</h4>
                    <p>The following parameters are automatically calculated based on your grid configuration:</p>
                    <ul>
                        {% if calculated_values %}
                            <li><strong>Total Categories:</strong> {{ calculated_values.total_categories }}</li>
                            <li><strong>Total Elements:</strong> {{ calculated_values.total_elements }}</li>
                            <li><strong>Tasks per Consumer:</strong> {{ calculated_values.tasks_per_consumer }} (calculated using advanced algorithm)</li>
                            <li><strong>Exposure Tolerance:</strong> Fixed at 1.0% for grid studies</li>
                        {% else %}
                            <li><strong>Tasks per Consumer:</strong> Will be calculated based on total elements</li>
                            <li><strong>Exposure Tolerance:</strong> Fixed at 1.0% for grid studies</li>
                            <li><strong>Total Elements:</strong> Sum of all elements across categories</li>
                        {% endif %}
                    </ul>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn--primary">
                    Generate Tasks
                </button>
            </div>
        </form>
    </div>
</div>

<style>
.info-box {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
}

.info-box h4 {
    color: #495057;
    margin-bottom: 10px;
}

.info-box ul {
    margin: 10px 0;
    padding-left: 20px;
}

.info-box li {
    margin: 5px 0;
    color: #6c757d;
}
</style>
{% endblock %}
